(this["webpackJsonpdp-simulation"]=this["webpackJsonpdp-simulation"]||[]).push([[0],{175:function(t,e,n){},296:function(t,e,n){"use strict";n.r(e);var r=n(151),i=n(119),a=n(8),s=(n(174),n(175),n(2));function o(){return Object(s.jsx)("div",{className:"App",children:Object(s.jsx)(a.a,{})})}var u=n(30),c=n(6),l=n(12),h=n(14),d=n(0),p=n(21),f=n(19),g=n(20),b=(n(124),n(68)),k=n.n(b),j=n(69),O=n.n(j),w=n(45),x=n.n(w),v=n(31),m=n.n(v),y=[],S=[],C=[],I=function(){function t(e){Object(f.a)(this,t),this.id=null,this.orchestratorId=null,this._status="pending",this.createdAt=null,this.lastUpdatedAt=null,this.startedAt=null,this.orgSlug=null,this.pipelineId=null,this.pipelineConfig={},this.protocol=null,this.tasks=[],this.id=e.pipelineId+"-"+t.idCounter++,this.createdAt=(new Date).toISOString(),this.lastUpdatedAt=(new Date).toISOString(),Object.assign(this,e)}return Object(g.a)(t,[{key:"status",get:function(){return this._status},set:function(t){this._status=t,this.lastUpdatedAt=(new Date).toISOString()}}],[{key:"getNForEnqueuer",value:function(t){for(var e=[],n=y.filter((function(t){return"pending"===t.status})),r=Object.values(m()(n,"pipelineId")),i=!1;!i;){i=!0;var a,s=Object(p.a)(r);try{for(s.s();!(a=s.n()).done;){var o=a.value.find((function(t){return"pending"===t.status}));if(o&&(o.status="queued",e.push(o),i=!1),e.length>=t)return e}}catch(u){s.e(u)}finally{s.f()}}return e}},{key:"getPendingForTheOrchestrator",value:function(t){return y.filter((function(e){return"pending"===e.status&&e.orchestratorId===t}))}}]),t}();I.idCounter=1;var D=function(){function t(e){Object(f.a)(this,t),this.id=null,this.workflow=null,this.taskScript=null,this.taskGroupHash=null,this.type="ecs",this.duration=5e3,this._status="pending",this.createdAt=null,this.startedAt=null,this.lastUpdatedAt=null,this.container=null,this.id=t.idCounter++,this.createdAt=(new Date).toISOString(),this.lastUpdatedAt=(new Date).toISOString(),Object.assign(this,e)}return Object(g.a)(t,[{key:"status",get:function(){return this._status},set:function(t){this._status=t,this.lastUpdatedAt=(new Date).toISOString()}}],[{key:"poll",value:function(t){var e=S.filter((function(e){return e.taskGroupHash===t&&"pending"===e.status})),n=Object(h.a)(e,1)[0];return n?(n.startedAt=(new Date).toISOString(),n.status="in-progress",n):null}}]),t}();D.idCounter=1;var A=function(){function t(e){Object(f.a)(this,t),this.id=null,this.taskGroupHash=null,this.pipelineId=null,this.type="ecs",this.duration=5e3,this.progress=0,this._status="creating",this.createdAt=null,this.startedAt=null,this.lastUpdatedAt=null,this.runningTask=null,this.reuseCount=0,this.memoryInMB=512,this.id=D.idCounter++,this.createdAt=(new Date).toISOString(),this.lastUpdatedAt=(new Date).toISOString(),Object.assign(this,e)}return Object(g.a)(t,[{key:"status",get:function(){return this._status},set:function(t){this._status=t,this.lastUpdatedAt=(new Date).toISOString()}}],[{key:"listForTaskGroupHash",value:function(t,e){return C.filter((function(n){return n.taskGroupHash===t&&e.includes(n.status)}))}}]),t}();A.idCounter=1;var T=1,M=function(t){return new Promise((function(e){return setTimeout(e,t/T)}))},W=function(){function t(e){Object(f.a)(this,t),this.dbContainer=null,this.type="ecs",this.emptyPolls=0,this.dbContainer=e,this.init()}return Object(g.a)(t,[{key:"init",value:function(){var e=Object(l.a)(Object(c.a)().mark((function e(){return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(t.startDelay[this.dbContainer.type]);case 2:this.run();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"run",value:function(){var e=Object(l.a)(Object(c.a)().mark((function e(){var n,r,i;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.dbContainer.startedAt=(new Date).toISOString(),this.dbContainer.status="running";case 2:if("running"!==this.dbContainer.status){e.next=29;break}if(!(n=this.pollNewTask())){e.next=23;break}this.dbContainer.runningTask=n,n.container=this.dbContainer,r=n.duration/1e3,i=0;case 9:if(!(i<r)){e.next=16;break}return e.next=12,M(1e3);case 12:n.progress=i/r;case 13:i++,e.next=9;break;case 16:n.progress=1,n.status="completed",this.dbContainer.runningTask=null,this.emptyPolls=0,this.dbContainer.reuseCount++,e.next=25;break;case 23:this.emptyPolls++,this.emptyPolls>t.maxEmptyPolls&&this.stop();case 25:return e.next=27,M(500);case 27:e.next=2;break;case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.dbContainer.status="stopped"}},{key:"pollNewTask",value:function(){return D.poll(this.dbContainer.taskGroupHash)}}]),t}();W.startDelay={ecs:5e3,windows:3e4},W.maxEmptyPolls=100;var N=function(){function t(){Object(f.a)(this,t),this.running=!1}return Object(g.a)(t,[{key:"run",value:function(){var t=Object(l.a)(Object(c.a)().mark((function t(){var e,n;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.running=!0,console.log("Checktainer started");case 2:if(!this.running){t.next=15;break}e=m()(S.filter((function(t){return"pending"===t.status})),"taskGroupHash"),t.t0=Object(c.a)().keys(e);case 5:if((t.t1=t.t0()).done){t.next=11;break}return n=t.t1.value,t.next=9,this.ensureGroup(n);case 9:t.next=5;break;case 11:return t.next=13,M(1e3);case 13:t.next=2;break;case 15:console.log("Checktainer stopped");case 16:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"stop",value:function(){this.running=!1}},{key:"calcDesiredCreateCount",value:function(t){return t.pendingTasksCount<1||t.numOfNonStoppedContainers>t.numOfRunningContainers?0:0===t.numOfNonStoppedContainers&&t.pendingTasksCount>0?t.initNumOfWorkersToCreate:t.numOfRunningContainers>t.runningTasksCount?0:t.numOfWorkersToInc}},{key:"ensureGroup",value:function(){var t=Object(l.a)(Object(c.a)().mark((function t(e){var n,r,i,a,s,o,u,l,d,p,f,g,b;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=S.filter((function(t){return t.taskGroupHash===e&&["pending","in-progress"].includes(t.status)})),r=A.listForTaskGroupHash(e,["creating","running"]),i=n.filter((function(t){return"pending"===t.status})),a=Object(h.a)(i,1),s=a[0],o=n.filter((function(t){return"pending"===t.status})).length,u=n.filter((function(t){return"in-progress"===t.status})).length,l=r.length,d=r.filter((function(t){return"running"===t.status})).length,p=this.calcDesiredCreateCount({pendingTasksCount:o,runningTasksCount:u,numOfRunningContainers:d,numOfNonStoppedContainers:l,initNumOfWorkersToCreate:1,numOfWorkersToInc:1}),f=p+u-l,g=0;g<f;g++)b=new A({taskGroupHash:e,type:s.type,pipelineId:s.workflow.pipelineId}),C.push(b),new W(b);case 11:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),P={enqueuer2Orchestrator:[]},U=function(t,e){var n;(n=P[t]).unshift.apply(n,Object(u.a)(e))},q=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=[];P[t].length&&n.length<e;)n.push(P[t].pop());return n},z=function(t){return P[t]},G=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(f.a)(this,t),this.id=null,this.running=!1,this.newMode=!1,this.reserved=!1,this.runningWorkflows=new Set([]),this.idlingStartedTimestamp=null,this.id=t.idCounter++,this.newMode=e,this.reserved=n}return Object(g.a)(t,[{key:"run",value:function(){var e=Object(l.a)(Object(c.a)().mark((function e(){return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(t.startDelay);case 2:if(this.idlingStartedTimestamp=Date.now(),!this.newMode){e.next=7;break}return e.abrupt("return",this.runNew());case 7:return e.abrupt("return",this.runOld());case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"runOld",value:function(){var e=Object(l.a)(Object(c.a)().mark((function e(){var n,r,i,a;return Object(c.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.running=!0,console.log("Orchestrator ".concat(this.id," started"));case 2:if(!this.running){e.next=28;break}if(!(this.runningWorkflows.size<t.runningWorkflowsMax)){e.next=24;break}n=q("enqueuer2Orchestrator",t.runningWorkflowsMax-this.runningWorkflows.size),r=Object(p.a)(n),e.prev=6,r.s();case 8:if((i=r.n()).done){e.next=16;break}if(a=i.value,this.runningWorkflows.add(a),this.runWorkflow(a),this.running){e.next=14;break}return e.abrupt("break",16);case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(6),r.e(e.t0);case 21:return e.prev=21,r.f(),e.finish(21);case 24:return e.next=26,M(1e3);case 26:e.next=2;break;case 28:console.log("Orchestrator ".concat(this.id," stopped"));case 29:case"end":return e.stop()}}),e,this,[[6,18,21,24]])})));return function(){return e.apply(this,arguments)}}()},{key:"runNew",value:function(){var t=Object(l.a)(Object(c.a)().mark((function t(){var e,n,r,i;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.running=!0,console.log("Orchestrator ".concat(this.id," started (new mode)"));case 2:if(!this.running){t.next=28;break}e=I.getPendingForTheOrchestrator(this.id),n=Object(p.a)(e),t.prev=5,n.s();case 7:if((r=n.n()).done){t.next=16;break}if(i=r.value,this.idlingStartedTimestamp=null,this.runningWorkflows.add(i),this.runWorkflow(i),this.running){t.next=14;break}return t.abrupt("break",16);case 14:t.next=7;break;case 16:t.next=21;break;case 18:t.prev=18,t.t0=t.catch(5),n.e(t.t0);case 21:return t.prev=21,n.f(),t.finish(21);case 24:return t.next=26,M(1e3);case 26:t.next=2;break;case 28:console.log("Orchestrator ".concat(this.id," stopped"));case 29:case"end":return t.stop()}}),t,this,[[5,18,21,24]])})));return function(){return t.apply(this,arguments)}}()},{key:"stop",value:function(){this.running=!1}},{key:"runWorkflow",value:function(){var t=Object(l.a)(Object(c.a)().mark((function t(e){var n,r,i;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.orchestratorId=this.id,e.status="in-progress",e.startedAt=(new Date).toISOString(),n=Object(p.a)(e.protocol.steps),t.prev=4,n.s();case 6:if((r=n.n()).done){t.next=12;break}return i=r.value,t.next=10,this.runTask(e,i);case 10:t.next=6;break;case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(4),n.e(t.t0);case 17:return t.prev=17,n.f(),t.finish(17);case 20:e.status="completed",this.runningWorkflows.delete(e),this.runningWorkflows.size||(this.idlingStartedTimestamp=Date.now());case 23:case"end":return t.stop()}}),t,this,[[4,14,17,20]])})));return function(e){return t.apply(this,arguments)}}()},{key:"runTask",value:function(){var t=Object(l.a)(Object(c.a)().mark((function t(e,n){var r;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=new D({workflow:e,image:n.image,taskGroupHash:[e.orgSlug,e.pipelineId,n.type,n.taskScript].join("-"),type:n.type,duration:n.duration}),S.push(r),e.tasks.push(r);case 3:if(!["pending","in-progress"].includes(r.status)){t.next=8;break}return t.next=6,M(1e3);case 6:t.next=3;break;case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"idlingDuration",get:function(){return this.idlingStartedTimestamp?Date.now()-this.idlingStartedTimestamp:0}}]),t}();G.idCounter=1,G.runningWorkflowsMax=10,G.startDelay=5e3;var H,L,_=function(){function t(){Object(f.a)(this,t),this.execQueueMaxLength=50,this.running=!1}return Object(g.a)(t,[{key:"run",value:function(){var t=Object(l.a)(Object(c.a)().mark((function t(){var e,n;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.running=!0,console.log("Enqueuer started");case 2:if(!this.running){t.next=9;break}return(e=this.execQueueMaxLength-P["enqueuer2Orchestrator"].length)>0&&(n=I.getNForEnqueuer(e),U("enqueuer2Orchestrator",n.reverse())),t.next=7,M(1e3);case 7:t.next=2;break;case 9:console.log("Enqueuer stopped");case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"stop",value:function(){this.running=!1}},{key:"setQueueMaxLength",value:function(t){this.execQueueMaxLength=t}}]),t}(),Q=function(){function t(){Object(f.a)(this,t),this.running=!1,this.orchestrators=[new G,new G],this.checktainer=new N,this.enqueuer=new _}return Object(g.a)(t,[{key:"addWorkflows",value:function(t){var e;(e=y).push.apply(e,Object(u.a)(t.map((function(t){return new I(t)}))))}},{key:"setNumOfOrchestrators",value:function(t){if(this.orchestrators.length<t)for(var e=this.orchestrators.length;e<t;e++){var n=new G;this.orchestrators.push(n),this.running&&n.run()}else for(var r=this.orchestrators.length;r>t;r--)this.orchestrators.pop().stop()}},{key:"setMaxWorkflowsPerOrchestrator",value:function(t){G.runningWorkflowsMax=t}},{key:"run",value:function(){var t=Object(l.a)(Object(c.a)().mark((function t(){var e,n,r,i;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=Object(p.a)(this.orchestrators);try{for(e.s();!(n=e.n()).done;)n.value.run()}catch(a){e.e(a)}finally{e.f()}this.checktainer.run(),this.enqueuer.run(),this.running=!0,console.log("Platform started");case 6:if(!this.running){t.next=11;break}return t.next=9,M(1e3);case 9:t.next=6;break;case 11:r=Object(p.a)(this.orchestrators);try{for(r.s();!(i=r.n()).done;)i.value.stop()}catch(a){r.e(a)}finally{r.f()}this.checktainer.stop(),this.enqueuer.stop(),console.log("Platform stopped");case 16:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"stop",value:function(){this.running=!1}},{key:"getStats",value:function(t){var e=y.filter((function(e){return e.pipelineId===t})),n=S.filter((function(e){return e.workflow.pipelineId===t})),r=C.filter((function(e){return e.pipelineId===t})),i=e.filter((function(t){return"completed"===t.status})).map((function(t){return{duration:new Date(t.lastUpdatedAt).getTime()-new Date(t.startedAt).getTime(),waiting:new Date(t.startedAt).getTime()-new Date(t.createdAt).getTime()}}));return{workflows:x()(e,"status"),tasks:x()(n,"status"),containers:x()(r,"status"),idlingContainers:r.filter((function(t){return"running"===t.status&&!t.runningTask})).length,inQueue:z("enqueuer2Orchestrator").filter((function(e){return e.pipelineId===t})).length,times:i.length?{durationMin:k()(i,"duration").duration/1e3,durationMax:O()(i,"duration").duration/1e3,waitingMin:k()(i,"waiting").waiting/1e3,waitingMax:O()(i,"waiting").waiting/1e3}:{}}}},{key:"state",get:function(){return{workflowsByStatus:m()(y,"status"),orchestrators:this.orchestrators.map((function(t){return{id:t.id,workflows:y.filter((function(e){return e.orchestratorId===t.id&&["pending","queued","in-progress"].includes(e.status)}))}})),execQueue:z("enqueuer2Orchestrator"),containers:C.filter((function(t){return["creating","running"].includes(t.status)}))}}},{key:"getStartedWorkflows",value:function(){return y.filter((function(t){return t.startedAt}))}},{key:"getStartedTasks",value:function(){return S.filter((function(t){return t.startedAt&&t.container}))}},{key:"getContainers",value:function(){return C}}]),t}(),B=n(152),E=n(153),F=n.n(E),R=n(97),J=n.n(R),K=function(){function t(e){Object(f.a)(this,t),this.running=!1,this.maxOrchestrators=8,this.platform=null,this.noScaleUpCounter=0,this.platform=e}return Object(g.a)(t,[{key:"getMaxWorkflowsPerPipeline",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1?arguments[1]:void 0;return Math.ceil(e/t)}},{key:"run",value:function(){var t=Object(l.a)(Object(c.a)().mark((function t(){var e,n,r,i,a,s,o,u,l,d,f,g,b,k,j,O,w,x;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.running=!0,console.log("Scheduler started");case 2:if(!this.running){t.next=61;break}if(e=G.runningWorkflowsMax*this.platform.orchestrators.length,n=y.filter((function(t){return["pending","in-progress"].includes(t.status)})),!(r=Object.values(m()(n,"pipelineId"))).length){t.next=52;break}i=this.getMaxWorkflowsPerPipeline(r.length,e),a=!1;case 9:if(a){t.next=52;break}a=!0,s=Object(p.a)(r),t.prev=12,s.s();case 14:if((o=s.n()).done){t.next=42;break}if(u=o.value,!(u.filter((function(t){return t.orchestratorId})).length<i)){t.next=40;break}if(l=u.find((function(t){return!t.orchestratorId}))){t.next=21;break}return t.abrupt("continue",40);case 21:d=J()(this.platform.orchestrators,(function(t){return y.filter((function(e){return["pending","in-progress"].includes(e.status)&&e.orchestratorId===t.id})).length})),f=Object(p.a)(d),t.prev=23,b=function(){var t=g.value;if(y.filter((function(e){return["pending","in-progress"].includes(e.status)&&e.orchestratorId===t.id})).length<G.runningWorkflowsMax)return l.orchestratorId=t.id,a=!1,"break"},f.s();case 26:if((g=f.n()).done){t.next=32;break}if("break"!==b()){t.next=30;break}return t.abrupt("break",32);case 30:t.next=26;break;case 32:t.next=37;break;case 34:t.prev=34,t.t0=t.catch(23),f.e(t.t0);case 37:return t.prev=37,f.f(),t.finish(37);case 40:t.next=14;break;case 42:t.next=47;break;case 44:t.prev=44,t.t1=t.catch(12),s.e(t.t1);case 47:return t.prev=47,s.f(),t.finish(47);case 50:t.next=9;break;case 52:return k=y.filter((function(t){return["pending","in-progress"].includes(t.status)&&t.orchestratorId})).length,j=y.filter((function(t){return!t.orchestratorId})),(O=j.length)>0&&k+O>e&&k>.8*e&&(w=Object(h.a)(j,1),x=w[0],Date.now()-new Date(x.createdAt).getTime()>3e4&&this.platform.orchestrators.length<this.maxOrchestrators&&this.noScaleUpCounter),this.noScaleUpCounter>0&&this.noScaleUpCounter--,t.next=59,M(1e3);case 59:t.next=2;break;case 61:console.log("Scheduler stopped");case 62:case"end":return t.stop()}}),t,this,[[12,44,47,50],[23,34,37,40]])})));return function(){return t.apply(this,arguments)}}()},{key:"stop",value:function(){this.running=!1}}]),t}(),Z=function(){function t(){Object(f.a)(this,t),this.running=!1,this.orchestrators=[new G(!0,!0),new G(!0,!0)],this.checktainer=new N,this.scheduler=null,this.scheduler=new K(this)}return Object(g.a)(t,[{key:"addWorkflows",value:function(t){var e;(e=y).push.apply(e,Object(u.a)(t.map((function(t){return new I(t)}))))}},{key:"incNumOfOrchestrators",value:function(){this.setNumOfOrchestrators(this.orchestrators.length+1)}},{key:"setNumOfOrchestrators",value:function(t){if(this.orchestrators.length<t)for(var e=this.orchestrators.length;e<t;e++){var n=new G(!0);this.orchestrators.push(n),this.running&&n.run()}else for(var r=this.orchestrators.length;r>t;r--)this.orchestrators.pop().stop()}},{key:"setMaxWorkflowsPerOrchestrator",value:function(t){G.runningWorkflowsMax=t}},{key:"run",value:function(){var t=Object(l.a)(Object(c.a)().mark((function t(){var e,n,r,i;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=Object(p.a)(this.orchestrators);try{for(e.s();!(n=e.n()).done;)n.value.run()}catch(a){e.e(a)}finally{e.f()}this.checktainer.run(),this.scheduler.run(),this.running=!0,console.log("Platform started");case 6:if(!this.running){t.next=12;break}return F()(this.orchestrators,(function(t){return!t.reserved&&t.idlingDuration>2e4&&!t.runningWorkflows.size&&(t.stop(),!0)})),t.next=10,M(1e3);case 10:t.next=6;break;case 12:r=Object(p.a)(this.orchestrators);try{for(r.s();!(i=r.n()).done;)i.value.stop()}catch(a){r.e(a)}finally{r.f()}this.checktainer.stop(),this.scheduler.stop(),console.log("Platform stopped");case 17:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"stop",value:function(){this.running=!1}},{key:"getStats",value:function(t){var e=y.filter((function(e){return e.pipelineId===t})),n=S.filter((function(e){return e.workflow.pipelineId===t})),r=C.filter((function(e){return e.pipelineId===t})),i=e.filter((function(t){return"completed"===t.status})).map((function(t){return{duration:new Date(t.lastUpdatedAt).getTime()-new Date(t.startedAt).getTime(),waiting:new Date(t.startedAt).getTime()-new Date(t.createdAt).getTime()}}));return{workflows:x()(e,"status"),tasks:x()(n,"status"),containers:x()(r,"status"),idlingContainers:r.filter((function(t){return"running"===t.status&&!t.runningTask})).length,times:i.length?{durationMin:k()(i,"duration").duration/1e3,durationMax:O()(i,"duration").duration/1e3,waitingMin:k()(i,"waiting").waiting/1e3,waitingMax:O()(i,"waiting").waiting/1e3}:{}}}},{key:"state",get:function(){return{workflowsByStatus:m()(y,"status"),orchestrators:this.orchestrators.map((function(t){return{id:t.id,workflows:y.filter((function(e){return e.orchestratorId===t.id&&["pending","queued","in-progress"].includes(e.status)}))}})),containers:C.filter((function(t){return["creating","running"].includes(t.status)}))}}},{key:"getStartedWorkflows",value:function(){return y.filter((function(t){return t.startedAt}))}},{key:"getStartedTasks",value:function(){return S.filter((function(t){return t.startedAt&&t.container}))}},{key:"getContainers",value:function(){return C}}]),t}(),V=n(48),X=n(297),Y=n(312),$=n(317),tt=n(86),et=n(75),nt=n(157),rt=n(122),it=n(66),at=n(123),st=n(316),ot=n(314),ut=n(315),ct=n(154),lt=n.n(ct),ht=n(73),dt=n.n(ht),pt=n(88),ft=0,gt=function(){var t=!B.parse(location.search).old;H||(H=t?new Z:new Q);var e=Object(d.useRef)(null),n=Object(d.useState)(!1),r=Object(h.a)(n,2),i=r[0],a=r[1],o=Object(d.useState)(null),p=Object(h.a)(o,2),f=p[0],g=p[1],b=Object(d.useState)(null),k=Object(h.a)(b,2),j=k[0],O=k[1],w=Object(d.useState)(1),x=Object(h.a)(w,2),v=x[0],m=x[1],y=Object(d.useState)(2),S=Object(h.a)(y,2),C=S[0],I=S[1],D=Object(d.useState)(10),A=Object(h.a)(D,2),M=A[0],W=A[1],N=Object(d.useState)(50),P=Object(h.a)(N,2),U=P[0],q=P[1],z=Object(d.useState)(100),G=Object(h.a)(z,2),_=G[0],E=G[1],F=function(){var t=Object(l.a)(Object(c.a)().mark((function t(){return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a(!0),H.run();case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),R=function(){var t=Object(l.a)(Object(c.a)().mark((function t(){return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return H.stop(),a(!1),t.next=4,K();case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),K=function(){var t=Object(l.a)(Object(c.a)().mark((function t(){var n,r,i,a,s,o,l;return Object(c.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:g({black:H.getStats("black"),red:H.getStats("red"),blue:H.getStats("blue")}),O(H.state),I(H.orchestrators.length),L?H.running&&ft?(n=H.getStartedTasks(),r=n.map((function(t){return{id:t.id,group:t.container.id,title:"task-".concat(t.id),content:"task-".concat(t.id),start:new Date(t.startedAt),end:"completed"!==t.status?new Date:new Date(t.lastUpdatedAt),type:"range",selectable:!1,style:"border-color: black; background-color: ".concat(t.workflow.pipelineId,"; opacity: 0.8; color: white;")}})),i=H.getContainers(),r.push.apply(r,Object(u.a)(i.map((function(t){return{id:"c-".concat(t.id),group:t.id,start:new Date(t.createdAt),end:"stopped"!==t.status?new Date:new Date(t.lastUpdatedAt),type:"background",selectable:!1,style:"background-color: ".concat(t.pipelineId,"; opacity: 0.3;")}})))),a=new pt.a(i.map((function(t,e){return{id:t.id,index:e,content:"<small>".concat("ecs"===t.type?"ecs":"win"," ").concat(t.memoryInMB,"MB</small>"),style:"color: ".concat(t.pipelineId,";")}}))),L.setData({groups:a,items:r})):(s=J()(H.getStartedWorkflows(),(function(t){return new Date(t.startedAt).getTime()})),(o=s.map((function(t){return{id:t.id,group:t.id,title:t.id,content:t.id,start:new Date(t.startedAt),end:"completed"!==t.status?new Date:new Date(t.lastUpdatedAt),type:"background",selectable:!1,style:"border-color: black; background-color: ".concat(t.pipelineId,"; opacity: 0.8; color: white;")}}))).push.apply(o,Object(u.a)(s.map((function(t){return{id:"".concat(t.id,"-created"),group:t.id,title:t.id,start:new Date(t.createdAt),type:"point",selectable:!1,className:"timeline-point-".concat(t.pipelineId)}})))),o.push.apply(o,Object(u.a)(s.reduce((function(t,e){return t.push.apply(t,Object(u.a)(e.tasks.filter((function(t){return t.startedAt})).map((function(t){return{id:"task-".concat(t.id),group:e.id,title:"".concat(t.id),start:new Date(t.startedAt),end:"completed"!==t.status?new Date:new Date(t.lastUpdatedAt),type:"range",selectable:!1,style:"border-color: white; background: none; color: white;"}})))),t}),[]))),l=new pt.a(s.map((function(t,e){return{id:t.id,index:e,content:""}}))),L.setData({groups:l,items:o})):L=new pt.b(e.current,[],new pt.a([]),{orientation:{axis:"both",item:"top"},groupOrder:"index",zoomFriction:20,preferZoom:!1,stack:!1,groupHeightMode:"fixed",tooltip:{followMouse:!0,delay:100},horizontalScroll:!0,verticalScroll:!0,zoomKey:"ctrlKey",start:new Date,end:new Date(Date.now()+3e5)});case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),ct=function(t){H.addWorkflows(lt()(_,(function(e){var n=t[dt()(0,t.length-1)];return{orgSlug:"st-org",pipelineId:n,protocol:{id:"someid",steps:{red:[{type:"ecs",duration:1e3*dt()(1,8),taskScript:"ts1"},{type:"windows",duration:5e3*dt()(1,5),taskScript:"ts2"}],blue:[{type:"ecs",duration:1e3*dt()(1,5),taskScript:"ts4"}],black:[{type:"ecs",duration:1e3*dt()(100,200),taskScript:"ts5"}]}[n]}}})))},ht=function(t){return Object(s.jsxs)(s.Fragment,{children:["windows"===t.type&&Object(s.jsx)(V.a,{name:"windows",className:"pull-right",color:t.pipelineId,disabled:!0}),"ecs"===t.type&&Object(s.jsx)(V.a,{name:"linux",className:"pull-right",color:t.pipelineId,disabled:!0})]})};return Object(d.useEffect)((function(){var t=setInterval(K,1e3);return K(),function(){clearInterval(t),L&&(L.destroy(),L=null)}}),[]),Object(s.jsxs)("div",{style:{padding:"14px 62px"},children:[Object(s.jsx)("style",{children:"\n       .timeline-point-blue { border-color: blue; }\n       .timeline-point-red { border-color: red; }\n       .timeline-point-black { border-color: black; }\n      "}),Object(s.jsxs)("h3",{children:[t?"New":"Old"," architecture simulation (",t?Object(s.jsx)("a",{href:"./?old=1",target:"_self",children:"switch to old"}):Object(s.jsx)("a",{href:"./",children:"switch to new"}),")"]}),Object(s.jsxs)("div",{children:[Object(s.jsx)(X.a,{disabled:i,loading:i,onClick:function(){return F()},children:"RUN"}),"\xa0",Object(s.jsx)(X.a,{disabled:!i,onClick:function(){return R()},children:"STOP"}),Object(s.jsx)(Y.a,{type:"number",size:"mini",label:"speed",min:"1",max:"100",step:"1",value:v,onChange:function(t){var e;m(t.target.value),e=1*t.target.value||1,T=e},style:{marginLeft:"30px"}}),Object(s.jsx)(Y.a,{type:"number",size:"mini",label:"orchestrators",min:"1",max:"8",step:"1",value:C,onChange:function(t){H.setNumOfOrchestrators(1*t.target.value||1),I(H.orchestrators.length)},style:{marginLeft:"4px"}}),Object(s.jsx)(Y.a,{type:"number",size:"mini",label:"workflows per orchestrator",min:"1",max:"100",step:"1",value:M,onChange:function(t){W(t.target.value),H.setMaxWorkflowsPerOrchestrator(1*t.target.value||1)},style:{marginLeft:"4px"}}),!t&&Object(s.jsx)(Y.a,{type:"number",size:"mini",label:"queue size",min:"5",max:"1000",step:"5",value:U,onChange:function(t){q(t.target.value),H.enqueuer.setQueueMaxLength(1*t.target.value||1)},style:{marginLeft:"4px"}}),Object(s.jsx)(X.a,{className:"pull-right",style:{marginLeft:"14px"},onClick:function(){return ct(["blue","red","black"])},children:"+mix"}),Object(s.jsx)(X.a,{className:"pull-right",color:"blue",onClick:function(){return ct(["blue"])},children:"+"}),Object(s.jsx)(X.a,{className:"pull-right",color:"red",onClick:function(){return ct(["red"])},children:"+"}),Object(s.jsx)(X.a,{className:"pull-right",color:"black",onClick:function(){return ct(["black"])},children:"+"}),Object(s.jsx)(Y.a,{type:"number",label:"to create",min:"1",max:"100",step:"1",value:_,onChange:function(t){E(t.target.value)},className:"pull-right",style:{marginRight:"8px"}})]}),Object(s.jsx)("div",{style:{marginTop:"10px"},children:j&&Object(s.jsxs)($.a,{children:[Object(s.jsx)(tt.a,{children:Object(s.jsxs)(et.a,{children:[Object(s.jsxs)(nt.a,{width:"1",children:["Pending [",(j.workflowsByStatus.pending||[]).length,"]"]}),!t&&Object(s.jsx)(nt.a,{width:"1",children:"Queue"}),j.orchestrators.map((function(t,e){return Object(s.jsxs)(nt.a,{width:"2",children:["Orch #",e+1," [",t.workflows.length,"]"]},t.id)})),Object(s.jsxs)(nt.a,{width:"2",children:["Containers [",j.containers.length,"]"]}),Object(s.jsx)(nt.a,{width:"2",children:"Stats"})]})}),Object(s.jsx)(rt.a,{children:Object(s.jsxs)(et.a,{children:[Object(s.jsx)(it.a,{verticalAlign:"top",children:(j.workflowsByStatus.pending||[]).map((function(t){return Object(s.jsx)("div",{style:{margin:"2px"},children:Object(s.jsx)(at.a,{size:"tiny",color:t.pipelineId,children:t.id})},t.id)}))}),!t&&Object(s.jsx)(it.a,{verticalAlign:"top",children:(j.execQueue||[]).map((function(t){return Object(s.jsx)("div",{style:{margin:"2px"},children:Object(s.jsx)(at.a,{size:"tiny",color:t.pipelineId,children:t.id})},t.id)}))}),j.orchestrators.map((function(t){return Object(s.jsx)(it.a,{verticalAlign:"top",children:t.workflows.map((function(t){return Object(s.jsx)("div",{children:Object(s.jsx)(st.a.Group,{horizontal:!0,size:"tiny",children:t.tasks.map((function(e){return Object(s.jsxs)(st.a,{compact:!0,color:t.pipelineId,children:[t.id,"-",e.id,"pending"===e.status&&Object(s.jsx)(V.a,{name:"hourglass",className:"pull-right",color:t.pipelineId,disabled:!0}),"in-progress"===e.status&&Object(s.jsx)(ot.a,{percent:100*e.progress,size:"tiny",style:{margin:"4px 0 0"},color:t.pipelineId})]},e.id)}))})},t.id)}))},t.id)})),Object(s.jsx)(it.a,{verticalAlign:"top",children:(j.containers||[]).map((function(t){return"creating"===t.status?Object(s.jsxs)(st.a,{color:t.pipelineId,children:["Creating ",t.type,"...",ht(t)]},t.id):t.runningTask?Object(s.jsxs)(st.a,{color:t.pipelineId,children:[t.runningTask.workflow.id,"-",t.runningTask.id," [",t.reuseCount,"]",ht(t),Object(s.jsx)(ot.a,{percent:100*t.runningTask.progress,size:"tiny",style:{margin:"4px 0 0"},color:t.pipelineId})]},t.id):Object(s.jsxs)(st.a,{color:t.pipelineId,children:["Idling [",t.reuseCount,"]",ht(t)]},t.id)}))}),Object(s.jsx)(it.a,{verticalAlign:"top",children:["black","red","blue"].map((function(t){return Object(s.jsx)(st.a,{color:t,children:Object(s.jsx)("pre",{style:{color:t},children:JSON.stringify(f[t],null,2)})},t)}))})]})})]})}),Object(s.jsx)("div",{style:{marginTop:"10px"},children:Object(s.jsx)(ut.a,{toggle:!0,label:ft?"Containers timeline":"Workflows timeline",onChange:function(){ft=1-ft,K()},value:ft})}),Object(s.jsx)("div",{ref:e,style:{marginTop:"10px"}})]})},bt=document.getElementById("root");Object(r.createRoot)(bt).render(Object(s.jsx)(i.a,{children:Object(s.jsx)(a.d,{children:Object(s.jsx)(a.b,{path:"/",element:Object(s.jsx)(o,{}),children:Object(s.jsx)(a.b,{index:!0,element:Object(s.jsx)(gt,{})})})})}))}},[[296,1,2]]]);
//# sourceMappingURL=main.02137e55.chunk.js.map